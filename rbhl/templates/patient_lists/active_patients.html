{% extends 'patient_lists/static_patient_list_base.html' %}
{% load staticfiles %}
{% block javascripts %}
<script src="{% static 'js/lib/jquery-1.11.3/jquery-1.11.3.js' %}"></script>
<script src="{% static 'js/rbhl/stupid_table.js' %}"></script>
{% endblock %}


{% block static_content %}
  <table id="patient-list" class="table table-striped table-hover">
    <thead>
    <tr>
      <th data-sort="string">Hospital number</th>
      <th data-sort="string">Name</th>
      <th data-sort="intWithNull" data-sort-default="desc" data-sort-onload="yes">Days since first attended</th>
      <th data-sort="string">Seen by</th>
    </tr>
    </thead>
    <tbody>
    {% for episode in object_list %}
      <tr onclick=window.location="{{ episode.get_absolute_url }}" class="pointer">
          <td>{{ episode.patient.demographics_set.get.hospital_number }}</td>
          <td>{{ episode.patient.demographics_set.get.name }}</td>
          {% with cliniclog=episode.cliniclog_set.get %}
          <td>
            {% if not cliniclog.days_since_first_attended == None %}
              {{ cliniclog.days_since_first_attended }}
            {% endif %}
          </td>
          <td>
            {% if episode.cliniclog_set.get.seen_by %}
              {{ episode.cliniclog_set.get.seen_by }}
            {% endif %}
          </td>
          {% endwith %}
      </tr>
    {% endfor %}
    </tbody>
  </table>
<script>
$(document).ready(function(){
  $("#patient-list").stupidtable({
    // default table sort for integers does not handle
    // empty rows. We want empty rows to appear last.
    "intWithNull": function(a,b){
      a = a.trim();
      b = b.trim();
      if(a === ""){
        a = -10000;
      }
      if(b === ""){
        b = -10000;
      }
      return parseInt(a, 10) - parseInt(b, 10);
    }
  });
})
</script>
{% endblock %}
